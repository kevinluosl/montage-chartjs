montageDefine("a85f63b","ui/popup/popup.reel/popup",{dependencies:["montage/ui/component"],factory:function(t,e){var n=t("montage/ui/component").Component;e.Popup=n.specialize({hasTemplate:{value:!0},anchorElement:{value:null},_anchor:{value:null},anchor:{get:function(){return this._anchor},set:function(t){t&&(this._anchor=t,this.anchorElement=t.nodeName?t:t.element)}},delegate:{value:null},contentEl:{value:null},containerEl:{value:null},_slot:{value:null},slot:{get:function(){return this._slot},set:function(t){this._slot=t,this.content&&(this._slot.content=this.content)}},_content:{value:null},content:{get:function(){return this._content},set:function(t){this._content!==t&&this.slot&&(this.slot.content=t),this._content=t,this._content.popup=this,this.needsDraw=!0}},_modal:{value:!1},modal:{get:function(){return this._modal},set:function(t){t=!!t,this._modal!==t&&(this._modal=t,this.needsDraw=!0)}},_position:{value:null},position:{get:function(){return this._position},set:function(t){this._position=t}},autoHide:{value:0},_displayed:{value:!1},displayed:{get:function(){return this._displayed},set:function(t){this._displayed!==t&&(this.needsDraw=!0),this._displayed=t}},focusOnShow:{value:!0},enterDocument:{value:function(t){t&&(this.type=this.type||"custom")}},_popupSlot:{value:null},_modalDialogMask:{value:null},_getElementPosition:{value:function(t){var e=0,n=0,i=0,a=0;if(t.offsetParent)do e+=t.offsetLeft,n+=t.offsetTop,i+=t.offsetHeight,a+=t.offsetWidth;while(t=t.offsetParent);return{top:n,left:e,height:i,width:a}}},_getCSSValue:{value:function(t){return null!=t?("number"==typeof t&&(t+="px"),t):""}},_positionPopup:{value:function(){var t,e,n=this.delegate,i=this.anchorElement;if(this.type,null!==this.position)t=this.position;else{var a=this.contentEl||this.content.element,r=parseFloat(a.style.height||0)||a.offsetHeight||0,s=parseFloat(a.style.width||0)||a.offsetWidth||0,o=window.innerHeight,l=window.innerWidth;if(i){var c=this._getElementPosition(i),h=parseFloat(i.style.height||0)||i.offsetHeight||0,u=parseFloat(i.style.width||0)||i.offsetWidth||0;t={top:c.top+h,left:c.left+u/2-s/2},0>t.left&&(t.left=c.left,this._showHidePointer(!1))}else t={top:o/2-r/2,left:l/2-s/2}}e=n&&"function"==typeof n.willPositionPopup?n.willPositionPopup(this,t):t;var d=this._popupSlot;e&&(d.element.style.top=this._getCSSValue(e.top),d.element.style.left=this._getCSSValue(e.left),d.element.style.right=this._getCSSValue(e.right),d.element.style.bottom=this._getCSSValue(e.bottom))}},_createModalMask:{value:function(){var t=document.createElement("div");return t.classList.add("montage-Popup-modal-mask"),t.style.zIndex=6999,t.classList.add("montage-invisible"),document.body.appendChild(t),t}},_showHidePointer:{value:function(){}},_addEventListeners:{value:function(){window.Touch?this.element.ownerDocument.addEventListener("touchstart",this,!1):(this.element.ownerDocument.addEventListener("mousedown",this,!1),this.element.ownerDocument.addEventListener("keyup",this,!1)),window.addEventListener("resize",this)}},_removeEventListeners:{value:function(){window.Touch?this.element.ownerDocument.removeEventListener("touchstart",this,!1):(this.element.ownerDocument.removeEventListener("mousedown",this,!1),this.element.ownerDocument.removeEventListener("keyup",this,!1)),window.removeEventListener("resize",this)}},show:{value:function(){var t=this.type,e=this;this.application.getPopupSlot(t,this,function(t){e._popupSlot=t,e.displayed=!0,e._addEventListeners()})}},hide:{value:function(){var t=this.type,e=this;this.application.getPopupSlot(t,this,function(){e._removeEventListeners(),e.displayed=!1})}},_showModalMask:{value:function(){this._modalDialogMask=document.querySelector("Popup-modal-mask"),this._modalDialogMask=this._modalDialogMask||this._createModalMask(),this._modalDialogMask.classList.remove("montage-invisible")}},_hideModalMask:{value:function(){var t=this.application._getActivePopupSlots(),e=0;if(t&&t.length>0){var n,i=t.length;for(n=0;i>n;n++)t[n].content&&t[n].content.modal===!0&&t[n].content.displayed===!0&&e++}0>=e&&this._modalDialogMask.classList.add("montage-invisible")}},draw:{value:function(){if(this.displayed){if(this.modal===!0)this.element.classList.add("montage-Popup--modal");else if(this.element.classList.remove("montage-Popup--modal"),this.autoHide){var t=this;setTimeout(function(){t.hide()},this.autoHide)}this.element.classList.remove("montage-invisible"),this.content.element.style.display="block",this.content.element.classList.remove("montage-invisible"),this.content.element.setAttribute("tabindex","0")}else this.element.classList.contains("montage-invisible")||this.element.classList.add("montage-invisible"),this.content.element.classList.add("montage-invisible"),this._popupSlot&&(this._popupSlot.content=null)}},didDraw:{value:function(){this._displayed?(this.modal===!0&&this._showModalMask(),this._positionPopup(),this.focusOnShow===!0&&this.content.element.focus()):this.modal===!0&&this._hideModalMask();var t=document.createEvent("CustomEvent");t.initCustomEvent(this._displayed===!0?"show":"hide",!0,!0,this),this.dispatchEvent(t)}},getZIndex:{value:function(t){for(var e,n,i;t&&t!==document;){if(e=t.style.position,("absolute"===e||"relative"===e||"fixed"===e)&&(i=t.style["z-index"],n=parseInt(i,10),!isNaN(n)&&0!==n))return n;t=t.parentNode}return 0}},_handleTouchMouseup:{value:function(t){var e=this.getZIndex(t.target),n=this.getZIndex(this.element);this.displayed===!0&&n>e&&(this.modal===!0||(this.displayed=!1))}},_timeoutId:{value:null},handleResize:{value:function(){var t=this;this.displayed===!0&&(window.clearTimeout(this._timeoutId),this._timeoutId=setTimeout(function(){t.needsDraw=!0},100))}},handleMousedown:{value:function(t){this._handleTouchMouseup(t)}},handleTouchstart:{value:function(t){this._handleTouchMouseup(t)}},handleKeyup:{value:function(t){this.displayed!==!0||this.modal||27!==t.keyCode||this.hide()}}})}});