montageDefine("a85f63b","ui/rich-text-editor/overlays/rich-text-linkpopup.reel/rich-text-linkpopup",{dependencies:["montage/ui/component"],factory:function(t,e){var n=t("montage/ui/component").Component;e.RichTextLinkPopup=n.specialize({_isActive:{enumerable:!1,value:!1},_editor:{enumerable:!1,value:null},target:{enumerable:!1,value:null},_needsReset:{enumerable:!1,value:!1},initWithEditor:{value:function(t){this._editor=t}},editorMouseUp:{value:function(t){var e;if(this._editor.activeOverlay!=this&&"IMG"==t.target.nodeName)for(e=t.target;e&&e!=this._element;){if("A"==e.nodeName)return e!=this.target&&(this.target=e,this._needsReset=!0,this._isActive?this.needsDraw=!0:this._editor.showOverlay(this)),!0;e=e.parentElement}}},editorTouchEnd:{value:function(t){this.editorMouseUp(t)}},editorSelectionDidChange:{value:function(t){var e;if(t&&t.collapsed)for(e=t.commonAncestorContainer;e&&e!=this._element;){if("A"==e.nodeName)return e!=this.target&&(this.target=e,this._needsReset=!0,this._isActive?this.needsDraw=!0:this._editor.showOverlay(this)),!0;e=e.parentElement}return this._editor.activeOverlay==this&&this._editor.hideOverlay(),this.target=null,!1}},didBecomeActive:{value:function(){this._isActive=!0,window.addEventListener("resize",this,!1)}},didBecomeInactive:{value:function(){this._isActive=!1,window.removeEventListener("resize",this,!1),this.target=null,this._needsReset=!1}},enterDocument:{value:function(t){t&&(this._popupExtraWidth=this.element.offsetWidth)}},draw:{enumerable:!1,value:function(){var t=this.element,e=this.target,n=this._editor.innerElement;if(this._needsReset){var i,a,r,s,o,l,c,h,u=n.offsetHeight,d=n.offsetWidth,p=n.scrollTop,g=n.scrollLeft,m=e.offsetWidth,f=e.offsetHeight,v="",_=function(t){for(a=t.offsetTop,i=t.offsetLeft;(t=t.offsetParent)&&t!=n;)a+=t.offsetTop,i+=t.offsetLeft};_(e),r=i,s=a,v=s>60&&s-p+f+50>u?"bottom: "+(u-s+5)+"px;":"top: "+(s+f+5)+"px;",o=g,c=g+d,l=c-r,h=r+m-o,l>h?150>l?(v+=" left: "+(o+5)+"px;",v+=" max-width: "+(d-10-this._popupExtraWidth)+"px;"):(v+=" left: "+(o+r)+"px;",v+=" max-width: "+(l-5-this._popupExtraWidth)+"px;"):150>h?(v+=" right: "+(o+5)+"px;",v+=" max-width: "+(d-10-this._popupExtraWidth)+"px;"):(v+=" right: "+(c-(o+r+m+1))+"px;",v+=" max-width: "+(h-this._popupExtraWidth)+"px;"),t.setAttribute("style",v),this.link.href=e.href,this.link.textContent=e.href,this._needsReset=!1}}},handleResize:{enumerable:!1,value:function(){this._needsReset=!0,this.needsDraw=!0}}})}});