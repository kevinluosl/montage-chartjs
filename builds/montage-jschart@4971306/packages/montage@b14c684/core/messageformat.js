(function(t){function e(t,i){var n;if(t&&i&&(e.locale[t]=i),n=t=t||"en",i=i||e.locale[n=e.Utils.getFallbackLocale(t)],!i)throw Error("Plural Function not found for locale: "+t);this.pluralFunc=i,this.locale=t,this.fallbackLocale=n}e.locale={en:function(t){return 1===t?"one":"other"}},e.SafeString=function(t){this.string=t},e.SafeString.prototype.toString=function(){return""+this.string},e.Utils={numSub:function(t,e,i){return t.replace(/^#|[^\\]#/g,function(t){var n=t&&2===t.length?t.charAt(0):"";return n+'" + (function(){ var x = '+e+';\nif( isNaN(x) ){\nthrow new Error("MessageFormat: `"+lastkey_'+i+'+"` isnt a number.");\n}\nreturn x;\n})() + "'})},escapeExpression:function(t){var i={"\n":"\\n",'"':'\\"'},n=/[\n"]/g,a=/[\n"]/,s=function(t){return i[t]||"&amp;"};return t instanceof e.SafeString?""+t:null===t||t===!1?"":a.test(t)?t.replace(n,s):t},getFallbackLocale:function(t){for(var i=t.indexOf("-")>=0?"-":"_";!e.locale.hasOwnProperty(t);)if(t=t.substring(0,t.lastIndexOf(i)),0===t.length)return null;return t}};var i=function(){var t={parse:function(t,e){function i(t,e,i){for(var n=t,a=i-t.length,s=0;a>s;s++)n=e+n;return n}function n(t){var e=t.charCodeAt(0);if(255>=e)var n="x",a=2;else var n="u",a=4;return"\\"+n+i(e.toString(16).toUpperCase(),"0",a)}function a(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,n)+'"'}function s(t){k>E||(E>k&&(k=E,B=[]),B.push(t))}function r(){var t="start@"+E,e=D[t];if(e)return E=e.nextPos,e.result;var i=E,n=o(),a=null!==n?function(t){return{type:"program",program:t}}(n):null;if(null!==a)var s=a;else{var s=null;E=i}return D[t]={nextPos:E,result:s},s}function o(){var t="messageFormatPattern@"+E,e=D[t];if(e)return E=e.nextPos,e.result;var i=E,n=E,a=L();if(null!==a){for(var s=[],r=l();null!==r;){s.push(r);var r=l()}if(null!==s)var o=[a,s];else{var o=null;E=n}}else{var o=null;E=n}var c=null!==o?function(t,e){var i=[];t&&t.val&&i.push(t);for(var n in e)e.hasOwnProperty(n)&&i.push(e[n]);return{type:"messageFormatPattern",statements:i}}(o[0],o[1]):null;if(null!==c)var h=c;else{var h=null;E=i}return D[t]={nextPos:E,result:h},h}function l(){var e="messageFormatPatternRight@"+E,i=D[e];if(i)return E=i.nextPos,i.result;var n=E,a=E;if("{"===t.substr(E,1)){var r="{";E+=1}else{var r=null;T&&s('"{"')}if(null!==r){var o=M();if(null!==o){var l=c();if(null!==l){var h=M();if(null!==h){if("}"===t.substr(E,1)){var u="}";E+=1}else{var u=null;T&&s('"}"')}if(null!==u){var d=L();if(null!==d)var p=[r,o,l,h,u,d];else{var p=null;E=a}}else{var p=null;E=a}}else{var p=null;E=a}}else{var p=null;E=a}}else{var p=null;E=a}}else{var p=null;E=a}var g=null!==p?function(t,e){var i=[];return t&&i.push(t),e&&e.val&&i.push(e),{type:"messageFormatPatternRight",statements:i}}(p[2],p[5]):null;if(null!==g)var f=g;else{var f=null;E=n}return D[e]={nextPos:E,result:f},f}function c(){var e="messageFormatElement@"+E,i=D[e];if(i)return E=i.nextPos,i.result;var n=E,a=E,r=C();if(null!==r){var o=E;if(","===t.substr(E,1)){var l=",";E+=1}else{var l=null;T&&s('","')}if(null!==l){var c=h();if(null!==c)var u=[l,c];else{var u=null;E=o}}else{var u=null;E=o}var d=null!==u?u:"";if(null!==d)var p=[r,d];else{var p=null;E=a}}else{var p=null;E=a}var g=null!==p?function(t,e){var i={type:"messageFormatElement",argumentIndex:t};return e&&e.length?i.elementFormat=e[1]:i.output=!0,i}(p[0],p[1]):null;if(null!==g)var f=g;else{var f=null;E=n}return D[e]={nextPos:E,result:f},f}function h(){var e="elementFormat@"+E,i=D[e];if(i)return E=i.nextPos,i.result;var n=E,a=E,r=M();if(null!==r){if("plural"===t.substr(E,6)){var o="plural";E+=6}else{var o=null;T&&s('"plural"')}if(null!==o){var l=M();if(null!==l){if(","===t.substr(E,1)){var c=",";E+=1}else{var c=null;T&&s('","')}if(null!==c){var h=M();if(null!==h){var p=u();if(null!==p){var g=M();if(null!==g)var f=[r,o,l,c,h,p,g];else{var f=null;E=a}}else{var f=null;E=a}}else{var f=null;E=a}}else{var f=null;E=a}}else{var f=null;E=a}}else{var f=null;E=a}}else{var f=null;E=a}var m=null!==f?function(t,e){return{type:"elementFormat",key:t,val:e.val}}(f[1],f[5]):null;if(null!==m)var v=m;else{var v=null;E=n}if(null!==v)var L=v;else{var C=E,y=E,w=M();if(null!==w){if("select"===t.substr(E,6)){var x="select";E+=6}else{var x=null;T&&s('"select"')}if(null!==x){var b=M();if(null!==b){if(","===t.substr(E,1)){var z=",";E+=1}else{var z=null;T&&s('","')}if(null!==z){var _=M();if(null!==_){var S=d();if(null!==S){var P=M();if(null!==P)var k=[w,x,b,z,_,S,P];else{var k=null;E=y}}else{var k=null;E=y}}else{var k=null;E=y}}else{var k=null;E=y}}else{var k=null;E=y}}else{var k=null;E=y}}else{var k=null;E=y}var B=null!==k?function(t,e){return{type:"elementFormat",key:t,val:e.val}}(k[1],k[5]):null;if(null!==B)var A=B;else{var A=null;E=C}if(null!==A)var L=A;else var L=null}return D[e]={nextPos:E,result:L},L}function u(){var t="pluralStyle@"+E,e=D[t];if(e)return E=e.nextPos,e.result;var i=E,n=p(),a=null!==n?function(t){return{type:"pluralStyle",val:t}}(n):null;if(null!==a)var s=a;else{var s=null;E=i}return D[t]={nextPos:E,result:s},s}function d(){var t="selectStyle@"+E,e=D[t];if(e)return E=e.nextPos,e.result;var i=E,n=f(),a=null!==n?function(t){return{type:"selectStyle",val:t}}(n):null;if(null!==a)var s=a;else{var s=null;E=i}return D[t]={nextPos:E,result:s},s}function p(){var t="pluralFormatPattern@"+E,e=D[t];if(e)return E=e.nextPos,e.result;var i=E,n=E,a=g(),s=null!==a?a:"";if(null!==s){for(var r=[],o=m();null!==o;){r.push(o);var o=m()}if(null!==r)var l=[s,r];else{var l=null;E=n}}else{var l=null;E=n}var c=null!==l?function(t,e){var i={type:"pluralFormatPattern",pluralForms:e};return i.offset=t?t:0,i}(l[0],l[1]):null;if(null!==c)var h=c;else{var h=null;E=i}return D[t]={nextPos:E,result:h},h}function g(){var e="offsetPattern@"+E,i=D[e];if(i)return E=i.nextPos,i.result;var n=E,a=E,r=M();if(null!==r){if("offset"===t.substr(E,6)){var o="offset";E+=6}else{var o=null;T&&s('"offset"')}if(null!==o){var l=M();if(null!==l){if(":"===t.substr(E,1)){var c=":";E+=1}else{var c=null;T&&s('":"')}if(null!==c){var h=M();if(null!==h){var u=x();if(null!==u){var d=M();if(null!==d)var p=[r,o,l,c,h,u,d];else{var p=null;E=a}}else{var p=null;E=a}}else{var p=null;E=a}}else{var p=null;E=a}}else{var p=null;E=a}}else{var p=null;E=a}}else{var p=null;E=a}var g=null!==p?function(t){return t}(p[5]):null;if(null!==g)var f=g;else{var f=null;E=n}return D[e]={nextPos:E,result:f},f}function f(){var t="selectFormatPattern@"+E,e=D[t];if(e)return E=e.nextPos,e.result;for(var i=E,n=[],a=m();null!==a;){n.push(a);var a=m()}var s=null!==n?function(t){return{type:"selectFormatPattern",pluralForms:t}}(n):null;if(null!==s)var r=s;else{var r=null;E=i}return D[t]={nextPos:E,result:r},r}function m(){var e="pluralForms@"+E,i=D[e];if(i)return E=i.nextPos,i.result;var n=E,a=E,r=M();if(null!==r){var l=v();if(null!==l){var c=M();if(null!==c){if("{"===t.substr(E,1)){var h="{";E+=1}else{var h=null;T&&s('"{"')}if(null!==h){var u=M();if(null!==u){var d=o();if(null!==d){var p=M();if(null!==p){if("}"===t.substr(E,1)){var g="}";E+=1}else{var g=null;T&&s('"}"')}if(null!==g)var f=[r,l,c,h,u,d,p,g];else{var f=null;E=a}}else{var f=null;E=a}}else{var f=null;E=a}}else{var f=null;E=a}}else{var f=null;E=a}}else{var f=null;E=a}}else{var f=null;E=a}}else{var f=null;E=a}var m=null!==f?function(t,e){return{type:"pluralForms",key:t,val:e}}(f[1],f[5]):null;if(null!==m)var L=m;else{var L=null;E=n}return D[e]={nextPos:E,result:L},L}function v(){var e="stringKey@"+E,i=D[e];if(i)return E=i.nextPos,i.result;var n=E,a=C(),r=null!==a?function(t){return t}(a):null;if(null!==r)var o=r;else{var o=null;E=n}if(null!==o)var l=o;else{var c=E,h=E;if("="===t.substr(E,1)){var u="=";E+=1}else{var u=null;T&&s('"="')}if(null!==u){var d=x();if(null!==d)var p=[u,d];else{var p=null;E=h}}else{var p=null;E=h}var g=null!==p?function(t){return t}(p[1]):null;if(null!==g)var f=g;else{var f=null;E=c}if(null!==f)var l=f;else var l=null}return D[e]={nextPos:E,result:l},l}function L(){var t="string@"+E,e=D[t];if(e)return E=e.nextPos,e.result;var i=E,n=E,a=M();if(null!==a){var s=[],r=E,o=M();if(null!==o){var l=y();if(null!==l){var c=M();if(null!==c)var h=[o,l,c];else{var h=null;E=r}}else{var h=null;E=r}}else{var h=null;E=r}for(;null!==h;){s.push(h);var r=E,o=M();if(null!==o){var l=y();if(null!==l){var c=M();if(null!==c)var h=[o,l,c];else{var h=null;E=r}}else{var h=null;E=r}}else{var h=null;E=r}}if(null!==s)var u=[a,s];else{var u=null;E=n}}else{var u=null;E=n}var d=null!==u?function(t,e){for(var i=[],n=0;e.length>n;++n)for(var a=0;e[n].length>a;++a)i.push(e[n][a]);return{type:"string",val:t+i.join("")}}(u[0],u[1]):null;if(null!==d)var p=d;else{var p=null;E=i}return D[t]={nextPos:E,result:p},p}function C(){var e="id@"+E,i=D[e];if(i)return E=i.nextPos,i.result;var n=E,a=E,r=M();if(null!==r){if(null!==t.substr(E).match(/^[a-zA-Z$_]/)){var o=t.charAt(E);E++}else{var o=null;T&&s("[a-zA-Z$_]")}if(null!==o){var l=[];if(null!==t.substr(E).match(/^[^ 	\n\r,.+={}]/)){var c=t.charAt(E);E++}else{var c=null;T&&s("[^ 	\\n\\r,.+={}]")}for(;null!==c;)if(l.push(c),null!==t.substr(E).match(/^[^ 	\n\r,.+={}]/)){var c=t.charAt(E);E++}else{var c=null;T&&s("[^ 	\\n\\r,.+={}]")}if(null!==l){var h=M();if(null!==h)var u=[r,o,l,h];else{var u=null;E=a}}else{var u=null;E=a}}else{var u=null;E=a}}else{var u=null;E=a}var d=null!==u?function(t,e){return t+(e?e.join(""):"")}(u[1],u[2]):null;if(null!==d)var p=d;else{var p=null;E=n}return D[e]={nextPos:E,result:p},p}function y(){var t="chars@"+E,e=D[t];if(e)return E=e.nextPos,e.result;var i=E,n=w();if(null!==n)for(var a=[];null!==n;){a.push(n);var n=w()}else var a=null;var s=null!==a?function(t){return t.join("")}(a):null;if(null!==s)var r=s;else{var r=null;E=i}return D[t]={nextPos:E,result:r},r}function w(){var e="char@"+E,i=D[e];if(i)return E=i.nextPos,i.result;var n=E;if(null!==t.substr(E).match(/^[^{}\\\0- 	\n\r]/)){var a=t.charAt(E);E++}else{var a=null;T&&s("[^{}\\\\\\0- 	\\n\\r]")}var r=null!==a?function(t){return t}(a):null;if(null!==r)var o=r;else{var o=null;E=n}if(null!==o)var l=o;else{var c=E;if("\\#"===t.substr(E,2)){var h="\\#";E+=2}else{var h=null;T&&s('"\\\\#"')}var u=null!==h?function(){return"\\#"}():null;if(null!==u)var d=u;else{var d=null;E=c}if(null!==d)var l=d;else{var p=E;if("\\{"===t.substr(E,2)){var g="\\{";E+=2}else{var g=null;T&&s('"\\\\{"')}var f=null!==g?function(){return"{"}():null;if(null!==f)var m=f;else{var m=null;E=p}if(null!==m)var l=m;else{var v=E;if("\\}"===t.substr(E,2)){var L="\\}";E+=2}else{var L=null;T&&s('"\\\\}"')}var C=null!==L?function(){return"}"}():null;if(null!==C)var y=C;else{var y=null;E=v}if(null!==y)var l=y;else{var w=E,x=E;if("\\u"===t.substr(E,2)){var M="\\u";E+=2}else{var M=null;T&&s('"\\\\u"')}if(null!==M){var z=b();if(null!==z){var _=b();if(null!==_){var S=b();if(null!==S){var P=b();if(null!==P)var k=[M,z,_,S,P];else{var k=null;E=x}}else{var k=null;E=x}}else{var k=null;E=x}}else{var k=null;E=x}}else{var k=null;E=x}var B=null!==k?function(t,e,i,n){return String.fromCharCode(parseInt("0x"+t+e+i+n))}(k[1],k[2],k[3],k[4]):null;if(null!==B)var A=B;else{var A=null;E=w}if(null!==A)var l=A;else var l=null}}}}return D[e]={nextPos:E,result:l},l}function x(){var e="digits@"+E,i=D[e];if(i)return E=i.nextPos,i.result;var n=E;if(null!==t.substr(E).match(/^[0-9]/)){var a=t.charAt(E);E++}else{var a=null;T&&s("[0-9]")}if(null!==a)for(var r=[];null!==a;)if(r.push(a),null!==t.substr(E).match(/^[0-9]/)){var a=t.charAt(E);E++}else{var a=null;T&&s("[0-9]")}else var r=null;var o=null!==r?function(t){return parseInt(t.join(""),10)}(r):null;if(null!==o)var l=o;else{var l=null;E=n}return D[e]={nextPos:E,result:l},l}function b(){var e="hexDigit@"+E,i=D[e];if(i)return E=i.nextPos,i.result;if(null!==t.substr(E).match(/^[0-9a-fA-F]/)){var n=t.charAt(E);E++}else{var n=null;T&&s("[0-9a-fA-F]")}return D[e]={nextPos:E,result:n},n}function M(){var t="_@"+E,e=D[t];if(e)return E=e.nextPos,e.result;var i=T;T=!1;for(var n=E,a=[],r=z();null!==r;){a.push(r);var r=z()}var o=null!==a?function(t){return t.join("")}(a):null;if(null!==o)var l=o;else{var l=null;E=n}return T=i,T&&null===l&&s("whitespace"),D[t]={nextPos:E,result:l},l}function z(){var e="whitespace@"+E,i=D[e];if(i)return E=i.nextPos,i.result;if(null!==t.substr(E).match(/^[ 	\n\r]/)){var n=t.charAt(E);E++}else{var n=null;T&&s("[ 	\\n\\r]")}return D[e]={nextPos:E,result:n},n}function _(){function e(t){t.sort();for(var e=null,i=[],n=0;t.length>n;n++)t[n]!==e&&(i.push(t[n]),e=t[n]);switch(i.length){case 0:return"end of input";case 1:return i[0];default:return i.slice(0,i.length-1).join(", ")+" or "+i[i.length-1]}}var i=e(B),n=Math.max(E,k),s=t.length>n?a(t.charAt(n)):"end of input";return"Expected "+i+" but "+s+" found."}function S(){for(var e=1,i=1,n=!1,a=0;k>a;a++){var s=t.charAt(a);"\n"===s?(n||e++,i=1,n=!1):"\r"===s|"\u2028"===s||"\u2029"===s?(e++,i=1,n=!0):(i++,n=!1)}return{line:e,column:i}}var P={_:M,"char":w,chars:y,digits:x,elementFormat:h,hexDigit:b,id:C,messageFormatElement:c,messageFormatPattern:o,messageFormatPatternRight:l,offsetPattern:g,pluralFormatPattern:p,pluralForms:m,pluralStyle:u,selectFormatPattern:f,selectStyle:d,start:r,string:L,stringKey:v,whitespace:z};if(void 0!==e){if(void 0===P[e])throw Error("Invalid rule name: "+a(e)+".")}else e="start";var E=0,T=!0,k=0,B=[],D={},A=P[e]();if(null===A||E!==t.length){var O=S();throw new this.SyntaxError(_(),O.line,O.column)}return A},toSource:function(){return this._source}};return t.SyntaxError=function(t,e,i){this.name="SyntaxError",this.message=t,this.line=e,this.column=i},t.SyntaxError.prototype=Error.prototype,t}();e.prototype.parse=function(){return i.parse.apply(i,arguments)},e.prototype.precompile=function(t){function i(t,r){r=r||{};var o,l,c,h="";switch(t.type){case"program":return i(t.program);case"messageFormatPattern":for(o=0;t.statements.length>o;++o)h+=i(t.statements[o],r);return s.begin+h+s.end;case"messageFormatPatternRight":for(o=0;t.statements.length>o;++o)h+=i(t.statements[o],r);return h;case"messageFormatElement":return r.pf_count=r.pf_count||0,h+='if(!d){\nthrow new Error("MessageFormat: No data passed to function.");\n}\n',t.output?h+='r += d["'+t.argumentIndex+'"];\n':(c="lastkey_"+(r.pf_count+1),h+="var "+c+' = "'+t.argumentIndex+'";\n',h+="var k_"+(r.pf_count+1)+"=d["+c+"];\n",h+=i(t.elementFormat,r)),h;case"elementFormat":return"select"===t.key?(h+=i(t.val,r),h+="r += (pf_"+r.pf_count+"[ k_"+(r.pf_count+1)+" ] || pf_"+r.pf_count+'[ "other" ])( d );\n'):"plural"===t.key&&(h+=i(t.val,r),h+="if ( pf_"+r.pf_count+"[ k_"+(r.pf_count+1)+' + "" ] ) {\n',h+="r += pf_"+r.pf_count+"[ k_"+(r.pf_count+1)+' + "" ]( d ); \n',h+="}\nelse {\n",h+="r += (pf_"+r.pf_count+'[ MessageFormat.locale["'+n.fallbackLocale+'"]( k_'+(r.pf_count+1)+" - off_"+r.pf_count+" ) ] || pf_"+r.pf_count+'[ "other" ] )( d );\n',h+="}\n"),h;case"pluralFormatPattern":for(r.pf_count=r.pf_count||0,h+="var off_"+r.pf_count+" = "+t.offset+";\n",h+="var pf_"+r.pf_count+" = { \n",a=!0,o=0;t.pluralForms.length>o;++o)"other"===t.pluralForms[o].key&&(a=!1),l?h+=",\n":l=1,h+='"'+t.pluralForms[o].key+'" : '+i(t.pluralForms[o].val,function(){var t=JSON.parse(JSON.stringify(r));return t.pf_count++,t}());if(h+="\n};\n",a)throw Error("No 'other' form found in pluralFormatPattern "+r.pf_count);return h;case"selectFormatPattern":for(r.pf_count=r.pf_count||0,h+="var off_"+r.pf_count+" = 0;\n",h+="var pf_"+r.pf_count+" = { \n",a=!0,o=0;t.pluralForms.length>o;++o)"other"===t.pluralForms[o].key&&(a=!1),l?h+=",\n":l=1,h+='"'+t.pluralForms[o].key+'" : '+i(t.pluralForms[o].val,function(){var t=JSON.parse(JSON.stringify(r));return t.pf_count++,t}());if(h+="\n};\n",a)throw Error("No 'other' form found in selectFormatPattern "+r.pf_count);return h;case"string":return'r += "'+e.Utils.numSub(e.Utils.escapeExpression(t.val),"k_"+r.pf_count+" - off_"+(r.pf_count-1),r.pf_count)+'";\n';default:throw Error("Bad AST type: "+t.type)}}var n=this,a=!1,s={begin:'function(d){\nvar r = "";\n',end:"return r;\n}"};return i(t)},e.prototype.compile=function(t){return Function("MessageFormat","return "+this.precompile(this.parse(t)))(e)},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.MessageFormat=e):"function"==typeof define&&define.amd?define(function(){return e}):t.MessageFormat=e})(this);