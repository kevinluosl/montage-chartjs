montageDefine("b14c684","core/request",{dependencies:["./promise"],factory:function(t,e,n){var i=t("./promise").Promise;e=n.exports=function(t){t=e.normalizeRequest(t);var n=i.defer(),a=t.xhr||new XMLHttpRequest;a.open(t.method,t.url,!0),a.onload=function(){var t={status:a.status,headers:e.parseResponseHeaders(a.getAllResponseHeaders()),body:a.response,xhr:a};n.resolve(t)},a.onerror=function(){n.reject(Error("Could not load"))};var s=t.headers;for(var r in s){var o=s[r];if(Array.isArray(o))for(var l=0;o.length>l;l++)a.setRequestHeader(r,o[l]);else a.setRequestHeader(r,o)}var c=t.options;for(var h in c)a[h]=c[h];return t.overrideMimeType&&a.overrideMimeType(t.overrideMimeType),a.send(t.body),n.promise},e.request=e,e.makeOk=function(t){return function(n){n=e.normalizeRequest(n);var a=n.url;return i.when(t(n),function(t){if(t.status>=200&&300>t.status)return t;var e=Error("Could not load "+JSON.stringify(a)+": "+t.status+" "+t.xhr.statusText);throw e.response=t,e})}},e.ok=e.makeOk(e.request),e.makeJson=function(t){return function(n){n=e.normalizeRequest(n);var a=n.url;return n.headers.accept=n.headers.accept||"application/json",n.headers["content-type"]=n.headers["content-type"]||"application/json","object"==typeof n.body&&(n.body=JSON.stringify(n.body)),n.overrideMimeType=n.overrideMimeType||"application/json",n.options.responseType=n.options.responseType||"json",i.when(t(n),function(t){if(null===t.body||"string"==typeof t.body)try{t.body=JSON.parse(t.body)}catch(e){throw Error("Could not parse JSON from "+JSON.stringify(a)+": "+e.message)}return t})}},e.json=e.makeJson(e.request),e.normalizeRequest=function(t){return"string"==typeof t&&(t={url:t}),t.method=t.method||"GET",t.headers=t.headers||{},t.options=t.options||{},t},e.parseResponseHeaders=function(t){var e={};return t?(t.replace(/^([^:]+):(.*)$/gm,function(t,n,i){n=n.trim().toLowerCase(),i=i.trim(),n in e?("string"==typeof e[n]&&(e[n]=[e[n]]),e[n].push(i)):e[n]=i}),e):e}}});