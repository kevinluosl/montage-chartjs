montageDefine("b14c684","core/state-chart",{dependencies:["./core"],factory:function(t,e){var i=t("./core").Montage,n=e.State=i.specialize({_stateChart:{enumerable:!1,value:null},constructor:{value:function n(){this.super()}},init:{value:function(t){this.substates={},this.enterState=null,this.exitState=null;for(var e,i,a=Object.keys(t),r=0;e=a[r];r++)i=t[e],"object"==typeof i&&n.prototype.isPrototypeOf(i)&&(i.name=e,i.parentState=this,this.substates[e]=i),this[e]="string"==typeof i&&"initialSubstate"!==e?this._encloseGotoState(i):i;return this}},name:{enumerable:!1,value:null},_initialSubstate:{enumerable:!1,value:null},initialSubstate:{get:function(){return"string"==typeof this._initialSubstate&&(this._initialSubstate=this[this._initialSubstate]),this._initialSubstate},set:function(t){this._initialSubstate=t}},substates:{enumerable:!1,value:null},parentState:{enumerable:!1,value:null},_path:{enumerable:!1,value:null},path:{enumerable:!1,get:function(){return this._path||(this._path=this.parentState&&this.parentState.path?this.parentState.path+"."+this.name:this.name),this._path}},enterState:{enumerable:!1,value:null},exitState:{enumerable:!1,value:null},isInState:{enumerable:!1,value:function(t){return"string"!=typeof t&&(t=t.name),!!this.path.match(RegExp(".?"+t+".?"))}},_encloseGotoState:{value:function(t){return function(e,i){return this._stateChart._gotoState(t,i)}}},gotoState:{value:function(t,e){return this._stateChart._gotoState(t,e)}},_performAction:{enumerable:null,value:function(t,e,i){if(this[t])this[t](e,i);else{if(!this.parentState)throw"Action '"+t+"' not available";this.parentState._performAction(t,e,i)}}},toString:{enumerable:!1,value:function(){return"[State "+this.path+" ]"}}});e.StateChart=i.specialize({delegate:{enumerable:!1,value:null},ownerStateProperty:{enumerable:!1,value:null},rootState:{enumerable:!1,value:null},_currentState:{enumerable:!1,value:null},currentState:{get:function(){return this.ownerStateProperty?null:this._currentState}},initWithState:{value:function(t){return this._states={},this.rootState=t,this.rootState._stateChart=this,this._prepareState(this.rootState),this.enterDefaultState(),this}},_defaultState:{enumerable:!1,value:null},defaultState:{enumerable:!1,get:function(){if(!this._defaultState){var t,e;for(t=e=this.rootState;e=e.initialSubstate;)t=e;this._defaultState=t}return this._defaultState}},enterDefaultState:{enumerable:!1,value:function(){if(this.ownerStateProperty&&!this.owner)throw"This stateChart has been configured to require an owner to execute this function";var t=this.ownerStateProperty?this.owner:this,e=this.ownerStateProperty?t["_"+this.ownerStateProperty]:t.currentState;if(e)throw"Cannot enter default state from '"+e.name+"'";var i,n;for(i=n=this.rootState;n=n.initialSubstate;)i.enterState&&i.enterState(this,t),i=n,n.initialSubstate&&i.exitState&&i.exitState(this,t);return this.ownerStateProperty?t["_"+this.ownerStateProperty]=this.defaultState:this._currentState=this.defaultState,this.defaultState}},_prepareState:{enumerable:!1,value:function(t){t._stateChart=this,t.name&&(this._states[t.name]=t);var e;for(e in t.substates)this._prepareState(t.substates[e])}},_states:{enumerable:!1,value:null},stateWithName:{enumerable:!1,value:function(t){return this._states[t]}},performAction:{value:function(t,e){if(this.ownerStateProperty&&!e)throw"This stateChart has been configured to require an owner to execute this function";e=this.ownerStateProperty?e:this;var i=this.ownerStateProperty?e[this.ownerStateProperty]:e.currentState;if(!i)throw"Cannot perform action '"+t+"' without a currentState";i._performAction(t,this,e),this.owner=null}},_gotoState:{value:function(t,e){if(this.ownerStateProperty&&!e)throw"This stateChart has been configured to require an owner to execute this function";e=this.ownerStateProperty?e:this;var i,n,a,r,s,o,l,c,h,u,d,p=this.ownerStateProperty?e[this.ownerStateProperty]:e.currentState,g=p.name,f=t,v=!1,m=!1,L=!1,y=!1;if("string"==typeof f?t=this._states[t]:f=t.name,f!==g&&(this.delegate&&(v="function"==typeof this.delegate.stateChartWillExitState,m="function"==typeof this.delegate.stateChartWillEnterState,L="function"==typeof this.delegate.stateChartDidExitState,y="function"==typeof this.delegate.stateChartDidEnterState),!this.delegate||"function"!=typeof this.delegate.stateChartShouldGoFromStateToState||this.delegate.stateChartShouldGoFromStateToState(this,p,t))){if(this.delegate&&"function"==typeof this.delegate.stateChartWillGoFromStateToState&&this.delegate.stateChartWillGoFromStateToState(this,p,t),i=p.path,n=t.path,RegExp(i).test(n))for(r=n.replace(RegExp(i+".?"),"").split("."),s=r.length,a=0;s>a;a++)u=this._states[r[a]],m&&this.delegate.stateChartWillEnterState(this,u),"function"==typeof u.enterState&&u.enterState(this,e),y&&this.delegate.stateChartDidEnterState(this,u);else{for(i=i.split("."),n=n.split("."),o=-1,c=n.length,h=Math.min(i.length,c);h>o&&(l=o+1,i[l]===n[l]);)o++;for(a=i.length-1;a>o;a--)u=this._states[i[a]],v&&this.delegate.stateChartWillExitState(this,u),"function"==typeof u.exitState&&u.exitState(this,e),L&&this.delegate.stateChartDidExitState(this,u);for(o=0>o?0:o,a=o;c>a;a++)u=this._states[n[a]],m&&this.delegate.stateChartWillEnterState(this,u),this.ownerStateProperty?e["_"+this.ownerStateProperty]=u:this._currentState=u,"function"==typeof u.enterState&&u.enterState(this,e),y&&this.delegate.stateChartDidEnterState(this,u)}d=p,this.delegate&&"function"==typeof this.delegate.stateChartDidGoFromStateToState&&this.delegate.stateChartDidGoFromStateToState(this,d,t),"function"==typeof e.transitionedFromStateToState&&e.transitionedFromStateToState(this,d,t)}}}})}});