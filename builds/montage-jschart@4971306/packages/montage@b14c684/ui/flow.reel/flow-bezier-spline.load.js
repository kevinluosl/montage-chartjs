montageDefine("b14c684","ui/flow.reel/flow-bezier-spline",{dependencies:["../../core/core"],factory:function(t,e){var n=t("../../core/core").Montage,i=e.FlowBezierSpline=n.specialize({constructor:{value:function i(){this._knots=[],this._densities=[]}},knots:{get:function(){return this._knots},set:function(t){this._knots=t}},previousHandlers:{get:function(){return this._previousHandlers||(this._previousHandlers=[]),this._previousHandlers},set:function(t){this._previousHandlers=t}},nextHandlers:{get:function(){return this._nextHandlers||(this._nextHandlers=[]),this._nextHandlers},set:function(t){this._nextHandlers=t}},densities:{get:function(){return this._densities},set:function(t){this._densities=t,this._densitiesLength=this._densities.length,this._maxTime=null}},_parameters:{value:{}},parameters:{get:function(){return this._parameters||(this._parameters={}),this._parameters},set:function(t){this._parameters=t,this._parametersLength=this._parameters.length}},_maxTime:{enumerable:!1,value:null},computeMaxTime:{value:function(){return this._computeDensitySummation(),this._maxTime=this._densitySummation.length?this._densitySummation[this._densitySummation.length-1]:0,this._maxTime}},_densitySummation:{enumerable:!1,value:null},_computeDensitySummation:{enumerable:!1,value:function(){var t,e=this.densities,n=e.length-1,i=0;for(this._densitySummation=[],t=0;n>t;t++)i+=(e[t]+e[t+1])/2,this._densitySummation[t]=i;this._maxTime=null}},_convertSplineTimeToBezierIndexTime:{enumerable:!1,value:function(t){if(0>t)return null;if(null===this._maxTime&&this.computeMaxTime(),t>=this._maxTime)return null;for(var e,n,i,a,r,s=this._densitySummation,o=s.length,l=o-1,c=o>>1;c;)l-c>=0&&s[l-c]>t?l-=c:c>>=1;return e=t-(l?s[l-1]:0),i=this._densities[l],a=this._densities[l+1],r=i-a,n=-1e-10>r||r>1e-10?(i-Math.sqrt(i*i+2*(a-i)*e))/r:e/i,[l,n]}},getPositionAtIndexTime:{value:function(t,e){var n=t[0],i=t[1],a=this._knots[n],r=this._nextHandlers[n],s=this._previousHandlers[n+1],o=this._knots[n+1],l=1-i,c=l*l*l,h=3*l*l*i,u=3*l*i*i,d=i*i*i;return e?[e.x.numerator*(a[0]*c+r[0]*h+s[0]*u+o[0]*d)/e.x.denominator,e.y.numerator*(a[1]*c+r[1]*h+s[1]*u+o[1]*d)/e.y.denominator,e.z.numerator*(a[2]*c+r[2]*h+s[2]*u+o[2]*d)/e.z.denominator]:[a[0]*c+r[0]*h+s[0]*u+o[0]*d,a[1]*c+r[1]*h+s[1]*u+o[1]*d,a[2]*c+r[2]*h+s[2]*u+o[2]*d]}},getRotationAtIndexTime:{value:function(t){var e,n,i,a=t[0],r=t[1],s=1-r,o=this._parameters;return e=o.rotateX!==void 0?o.rotateX.data[a]*s+o.rotateX.data[a+1]*r:0,n=o.rotateY!==void 0?o.rotateY.data[a]*s+o.rotateY.data[a+1]*r:0,i=o.rotateZ!==void 0?o.rotateZ.data[a]*s+o.rotateZ.data[a+1]*r:0,[e,n,i]}},getStyleAtIndexTime:{value:function(t){var e,n,i,a,r,s,o=t[0],l=t[1],c=this._parameters,h=1-l,u="";for(i=Object.keys(c),a=i.length,e=0;a>e;e++)n=i[e],r=c[n],s=r.data,"rotateX"!==n&&"rotateY"!==n&&"rotateZ"!==n&&s[o]!==void 0&&s[o+1]!==void 0&&(u+=n+":"+1e-5*(1e5*(s[o]*h+s[o+1]*l)>>0)+r.units+";");return u}},transformVectorArray:{value:function(t,e){var n,i,a=t.length,r=[];for(i=0;a>i;i++)n=t[i],n&&(r[i]=[n[0]*e[0]+n[1]*e[4]+n[2]*e[8]+e[12],n[0]*e[1]+n[1]*e[5]+n[2]*e[9]+e[13],n[0]*e[2]+n[1]*e[6]+n[2]*e[10]+e[14]]);return r}},transform:{value:function(t){var e=new i;return e._densities=this._densities,e._densitySummation=this._densitySummation,e._knots=this.transformVectorArray(this.knots,t),e._previousHandlers=this.transformVectorArray(this.previousHandlers,t),e._nextHandlers=this.transformVectorArray(this.nextHandlers,t),e}},deCasteljau:{value:function(t,e,n,i,a){var r=1-a,s=r*t[0]+a*e[0],o=r*e[0]+a*n[0],l=r*n[0]+a*i[0],c=r*s+a*o,h=r*o+a*l,u=r*c+a*h,d=r*t[1]+a*e[1],p=r*e[1]+a*n[1],g=r*n[1]+a*i[1],f=r*d+a*p,m=r*p+a*g,v=r*f+a*m,b=r*t[2]+a*e[2],L=r*e[2]+a*n[2],y=r*n[2]+a*i[2],C=r*b+a*L,_=r*L+a*y,w=r*C+a*_;return[[t,[s,d,b],[c,f,C],[u,v,w]],[[u,v,w],[h,m,_],[l,g,y],i]]}},cubic:{enumerable:!1,value:function(t,e,n,i,a){return((t*a+e)*a+n)*a+i}},cubeRoot:{enumerable:!1,value:function(t){return t>0?Math.pow(t,1/3):-Math.pow(-t,1/3)}},cubicRealRoots:{enumerable:!1,value:function(t,e,n,i){var a=1e-10,r=Math;if(-a>t||t>a){var s=1/t,o=e*s,l=n*s,c=(3*l-o*o)*(1/9),h=(4.5*o*l-13.5*i*s-o*o*o)*(1/27),u=c*c*c+h*h;if(u>a){var d=r.sqrt(u);return[this.cubeRoot(h+d)+this.cubeRoot(h-d)+o*(-1/3)]}if(u>-a){if(-a>h||h>a){var p=this.cubeRoot(h),g=2*p+o*(-1/3),f=o*(-1/3)-p;return f>g?[g,f]:[f,g]}return[o*(-1/3)]}var m=r.acos(h/r.sqrt(-c*c*c))*(1/3),v=r.sqrt(-c),b=1.7320508075688772*v*r.sin(m),L=o*(-1/3);return v*=r.cos(m),[L-v-b,L-v+b,L+2*v]}if(-a>e||e>a){var y=n*n-4*e*i;return y>=0?(y=r.sqrt(y),[(-n-y)/(2*e),(y-n)/(2*e)]):[]}return-a>n||n>a?[-i/n]:[]}},_halfPI:{enumerable:!1,value:.5*Math.PI},reflectionMatrix:{enumerable:!1,value:function(t,e,n){var i=Math,a=this._halfPI-i.atan2(e,t),r=i.sin(a),s=i.cos(a),o=this._halfPI-i.atan2(n,t*r+e*s),l=i.sin(o);return[l*r,s*l,i.cos(o)]}},reflectedY:{enumerable:!1,value:function(t,e,n,i){return t*i[0]+e*i[1]+n*i[2]}},getScaledKnots:{value:function(t){var e,n=[];for(e=0;this._knots.length>e;e++)this._knots[e]&&(n[e]=[t.x.numerator*this._knots[e][0]/t.x.denominator,t.y.numerator*this._knots[e][1]/t.y.denominator,t.z.numerator*this._knots[e][2]/t.z.denominator]);return n}},getScaledPreviousHandlers:{value:function(t){var e,n=[];for(e=0;this._previousHandlers.length>e;e++)this._previousHandlers[e]&&(n[e]=[t.x.numerator*this._previousHandlers[e][0]/t.x.denominator,t.y.numerator*this._previousHandlers[e][1]/t.y.denominator,t.z.numerator*this._previousHandlers[e][2]/t.z.denominator]);return n}},getScaledNextHandlers:{value:function(t){var e,n=[];for(e=0;this._nextHandlers.length>e;e++)this._nextHandlers[e]&&(n[e]=[t.x.numerator*this._nextHandlers[e][0]/t.x.denominator,t.y.numerator*this._nextHandlers[e][1]/t.y.denominator,t.z.numerator*this._nextHandlers[e][2]/t.z.denominator]);return n}},directedPlaneBezierIntersection:{enumerable:!1,value:function(t,e,n,i,a,r,s,o){for(var l,c,h=this.reflectionMatrix(i[0],i[1],i[2]),u=this.reflectedY(a[0]-t,a[1]-e,a[2]-n,h),d=this.reflectedY(r[0]-t,r[1]-e,r[2]-n,h),p=this.reflectedY(s[0]-t,s[1]-e,s[2]-n,h),g=this.reflectedY(o[0]-t,o[1]-e,o[2]-n,h),f=3*(d-p)+g-u,m=3*(u+p)-6*d,v=3*(d-u),b=this.cubicRealRoots(f,m,v,u),L=0,y=0,C=[];b.length>y&&0>=b[y];)y++;for(;b.length>y&&1>b[y];)l=L,L=b[y],c=.5*(l+L),this.cubic(f,m,v,u,c)>=0&&C.push([l,L]),y++;return c=.5*(L+1),this.cubic(f,m,v,u,c)>=0&&C.push([L,1]),C}}})}});