(function(t){function e(){}function n(t){var n=e.prototype.getCustomObjectTypeOf;return function(e){return t(e)||n(e)}}var i=function(){return this}(),r=require("q");Object.defineProperties(e.prototype,{_createAssignValueFunction:{value:function(t,e){return function(n){t[e]=n}}},getTypeOf:{value:function(t){var e=typeof t;return null===t?"null":Array.isArray(t)?"array":"object"===e&&1===Object.keys(t).length?"@"in t?"reference":"/"in t?"regexp":"object":e}},getCustomObjectTypeOf:{writable:!0,value:function(){}},reviveRootObject:{value:function(t,e,n){var i;return t.debugger,"value"in t?e.hasUserObject(n)?(i=e.getUserObject(n),e.setObjectLabel(i,n),i):this.reviveValue(t.value,e,n):0===Object.keys(t).length?e.hasUserObject(n)?(i=e.getUserObject(n),e.setObjectLabel(i,n),i):this.reviveExternalObject(t,e,n):this.reviveCustomObject(t,e,n)}},reviveValue:{value:function(t,e,n){var i=this.getTypeOf(t);return"string"===i||"number"===i||"boolean"===i||"null"===i||"undefined"===i?this.reviveNativeValue(t,e,n):"regexp"===i?this.reviveRegExp(t,e,n):"reference"===i?this.reviveObjectReference(t,e,n):"array"===i?this.reviveArray(t,e,n):"object"===i?this.reviveObjectLiteral(t,e,n):this._callReviveMethod("revive"+i,t,e,n)}},reviveNativeValue:{value:function(t,e,n){return n&&e.setObjectLabel(t,n),t}},reviveObjectLiteral:{value:function(t,e,n){var i,a=[];n&&e.setObjectLabel(t,n);for(var s in t)i=this.reviveValue(t[s],e),r.isPromise(i)?a.push(i.then(this._createAssignValueFunction(t,s))):t[s]=i;return 0===a.length?t:r.all(a).then(function(){return t})}},reviveRegExp:{value:function(t,e,n){var t=t["/"],i=RegExp(t.source,t.flags);return n&&e.setObjectLabel(i,n),i}},reviveObjectReference:{value:function(t,e){var t=t["@"],n=e.getObject(t);return n}},reviveArray:{value:function(t,e,n){var i,a=[];n&&e.setObjectLabel(t,n);for(var s=0,o=t.length;o>s;s++)i=this.reviveValue(t[s],e),r.isPromise(i)?a.push(i.then(this._createAssignValueFunction(t,s))):t[s]=i;return 0===a.length?t:r.all(a).then(function(){return t})}},reviveCustomObject:{value:function(t,e,n){var s=this.getCustomObjectTypeOf(t),o=a["revive"+s];return s?o.call(i,t,e,n):r.reject(Error("Object's type is unknown: "+JSON.stringify(t)))}},reviveExternalObject:{value:function(t,e,n){return r.reject(Error("External object '"+n+"' not found in user objects."))}},_callReviveMethod:{value:function(t,e,n,i){return this[t](e,n,i)}}});var a=Object.create(null);e.addCustomObjectReviver=function(t){for(var e in t)if("getTypeOf"!==e&&"function"==typeof t[e]&&/^revive/.test(e)){if(void 0!==a[e])return Error("Reviver '"+e+"' is already registered.");a[e]=t[e].bind(t)}this.prototype.getCustomObjectTypeOf=n(t.getTypeOf)},e.resetCustomObjectRevivers=function(){a=Object.create(null),this.prototype.getCustomObjectTypeOf=function(){}},t.Reviver=e})(exports),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});